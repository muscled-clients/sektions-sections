{% comment %}
  Slideshow Hero - Blooming Garden
  Full-width hero section with auto-rotating background images, centered content, and tab navigation with progress bar
{% endcomment %}

<div class="slideshow-hero-blooming-garden" data-section-id="{{ section.id }}" style="background: transparent !important; padding: 0 !important; margin: 0 !important;">
  <div class="slideshow-hero__wrapper" style="background: transparent !important;">
    <!-- Background Slides -->
    <div class="slideshow-hero__slides">
      {% for block in section.blocks %}
        <div class="slideshow-hero__slide {% if forloop.first %}active{% endif %}" data-slide-index="{{ forloop.index0 }}">
          {% if block.settings.image %}
            <img src="{{ block.settings.image | img_url: '2000x' }}" alt="{{ block.settings.tab_label }}" loading="{% if forloop.first %}eager{% else %}lazy{% endif %}">
          {% else %}
            <div class="slideshow-hero__placeholder">{{ 'lifestyle-1' | placeholder_svg_tag }}</div>
          {% endif %}
          <div class="slideshow-hero__overlay"></div>
        </div>
      {% endfor %}
    </div>

    <!-- Content -->
    <div class="slideshow-hero__content" style="background: transparent !important;">
      <div class="slideshow-hero__text-wrapper" style="background: transparent !important;">
        {% if section.settings.heading != blank %}
          <h1 class="slideshow-hero__heading" style="color: #ffffff !important; background: transparent !important;">{{ section.settings.heading }}</h1>
        {% endif %}

        {% if section.settings.subheading != blank %}
          <p class="slideshow-hero__subheading" style="color: #ffffff !important; background: transparent !important;">{{ section.settings.subheading }}</p>
        {% endif %}

        <div class="slideshow-hero__buttons" style="background: transparent !important;">
          {% if section.settings.button_1_text != blank %}
            <a href="{{ section.settings.button_1_link }}" class="slideshow-hero__button slideshow-hero__button--primary">
              {{ section.settings.button_1_text }}
            </a>
          {% endif %}

          {% if section.settings.button_2_text != blank %}
            <a href="{{ section.settings.button_2_link }}" class="slideshow-hero__button slideshow-hero__button--secondary">
              {{ section.settings.button_2_text }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Navigation Tabs and Progress Bar -->
    {% if section.blocks.size > 1 %}
      <div class="slideshow-hero__navigation">
        <div class="slideshow-hero__tabs">
          {% for block in section.blocks %}
            <button class="slideshow-hero__tab {% if forloop.first %}active{% endif %}" data-tab-index="{{ forloop.index0 }}" aria-label="Go to {{ block.settings.tab_label }}">
              {{ block.settings.tab_label }}
            </button>
            {% unless forloop.last %}
              <span class="slideshow-hero__tab-separator">|</span>
            {% endunless %}
          {% endfor %}
        </div>
        <div class="slideshow-hero__progress-bar">
          <div class="slideshow-hero__progress-fill"></div>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<style>
.slideshow-hero-blooming-garden {
  position: relative;
  width: 100%;
  height: 600px;
  overflow: hidden;
  background: transparent !important;
  padding: 0 !important;
  margin: 0 !important;
}

.slideshow-hero__wrapper {
  position: relative;
  width: 100%;
  height: 100%;
  background: transparent !important;
}

/* Background Slides */
.slideshow-hero__slides {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slideshow-hero__slide {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 1s ease-in-out;
  z-index: 1;
}

.slideshow-hero__slide.active {
  opacity: 1;
  z-index: 2;
}

.slideshow-hero__slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.slideshow-hero__placeholder {
  width: 100%;
  height: 100%;
  background-color: #f5f5f5;
}

.slideshow-hero__placeholder svg {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.slideshow-hero__overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.3);
  z-index: 1;
}

/* Content */
.slideshow-hero__content {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3;
  padding: 40px 20px 120px;
  background: transparent !important;
}

.slideshow-hero__text-wrapper {
  text-align: center;
  max-width: 800px;
  color: #ffffff !important;
  background: transparent !important;
}

.slideshow-hero__heading {
  font-size: 48px;
  font-weight: 700;
  line-height: 1.2;
  margin: 0 0 20px;
  color: #ffffff !important;
  background: transparent !important;
}

.slideshow-hero__subheading {
  font-size: 16px;
  font-weight: 400;
  line-height: 1.6;
  margin: 0 0 30px;
  color: #ffffff !important;
  opacity: 0.95;
  background: transparent !important;
}

/* Buttons */
.slideshow-hero__buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  background: transparent !important;
}

.slideshow-hero__button {
  display: inline-block;
  padding: 14px 32px;
  font-size: 16px;
  font-weight: 500;
  text-decoration: none;
  border-radius: 2px;
  transition: all 0.3s ease;
  cursor: pointer;
  border: none;
  text-transform: capitalize;
}

.slideshow-hero__button--primary {
  background-color: #ffffff;
  color: #000000;
}

.slideshow-hero__button--primary:hover {
  background-color: #f0f0f0;
  transform: translateY(-2px);
}

.slideshow-hero__button--secondary {
  background-color: #ffffff;
  color: #000000;
}

.slideshow-hero__button--secondary:hover {
  background-color: #f0f0f0;
  transform: translateY(-2px);
}

/* Navigation */
.slideshow-hero__navigation {
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 4;
  width: 100%;
  max-width: 600px;
  padding: 0 20px;
}

.slideshow-hero__tabs {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 10px;
}

.slideshow-hero__tab {
  background: none;
  border: none;
  color: #ffffff;
  font-size: 14px;
  font-weight: 400;
  cursor: pointer;
  padding: 0;
  opacity: 0.7;
  transition: opacity 0.3s ease;
  text-transform: capitalize;
}

.slideshow-hero__tab:hover,
.slideshow-hero__tab.active {
  opacity: 1;
}

.slideshow-hero__tab-separator {
  color: #ffffff;
  opacity: 0.5;
  font-size: 14px;
}

/* Progress Bar */
.slideshow-hero__progress-bar {
  width: 100%;
  height: 2px;
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 1px;
  overflow: hidden;
}

.slideshow-hero__progress-fill {
  height: 100%;
  background-color: #ffffff;
  width: 0%;
  transition: width 0.1s linear;
}

/* Responsive */
@media screen and (max-width: 768px) {
  .slideshow-hero-blooming-garden {
    height: 500px;
  }

  .slideshow-hero__heading {
    font-size: 32px;
    margin-bottom: 15px;
  }

  .slideshow-hero__subheading {
    font-size: 14px;
    margin-bottom: 25px;
  }

  .slideshow-hero__button {
    padding: 12px 24px;
    font-size: 14px;
  }

  .slideshow-hero__navigation {
    bottom: 20px;
  }

  .slideshow-hero__tabs {
    gap: 8px;
  }

  .slideshow-hero__tab {
    font-size: 12px;
  }
}

@media screen and (max-width: 480px) {
  .slideshow-hero-blooming-garden {
    height: 450px;
  }

  .slideshow-hero__heading {
    font-size: 26px;
  }

  .slideshow-hero__subheading {
    font-size: 13px;
  }

  .slideshow-hero__buttons {
    gap: 10px;
  }

  .slideshow-hero__button {
    padding: 10px 20px;
    font-size: 13px;
  }
}

/* Override any theme color scheme styles */
.slideshow-hero-blooming-garden * {
  box-sizing: border-box;
}

.slideshow-hero-blooming-garden h1,
.slideshow-hero-blooming-garden p {
  color: #ffffff !important;
  background: none !important;
}

/* Override ALL possible Shopify color scheme classes */
.slideshow-hero-blooming-garden[class*="color-"],
.slideshow-hero-blooming-garden .slideshow-hero__slide[class*="color-"],
.slideshow-hero-blooming-garden,
section[class*="color-"] .slideshow-hero-blooming-garden,
div[class*="color-"] .slideshow-hero-blooming-garden {
  background: transparent !important;
  --color-background: transparent !important;
  --gradient-background: transparent !important;
  padding: 0 !important;
  margin: 0 !important;
}

.slideshow-hero-blooming-garden [class*="color-"] h1,
.slideshow-hero-blooming-garden [class*="color-"] p,
.slideshow-hero-blooming-garden h1,
.slideshow-hero-blooming-garden p,
.slideshow-hero-blooming-garden .slideshow-hero__heading,
.slideshow-hero-blooming-garden .slideshow-hero__subheading,
section[class*="color-"] .slideshow-hero-blooming-garden h1,
section[class*="color-"] .slideshow-hero-blooming-garden p {
  color: #ffffff !important;
  background: transparent !important;
  --color-foreground: #ffffff !important;
}

/* Override gradient class if present */
.slideshow-hero-blooming-garden.gradient,
.slideshow-hero-blooming-garden .gradient {
  background: transparent !important;
}
</style>

<script>
(function() {
  const section = document.querySelector('.slideshow-hero-blooming-garden[data-section-id="{{ section.id }}"]');
  if (!section) return;

  // Remove any color scheme classes that Shopify might add
  function removeColorSchemeClasses() {
    const sectionParent = section.parentElement;
    if (sectionParent) {
      // Remove color scheme classes from parent section wrapper
      const classesToRemove = [];
      sectionParent.classList.forEach(className => {
        if (className.includes('color-') || className === 'gradient') {
          classesToRemove.push(className);
        }
      });
      classesToRemove.forEach(className => sectionParent.classList.remove(className));
    }

    // Remove from section itself
    const sectionClassesToRemove = [];
    section.classList.forEach(className => {
      if (className.includes('color-') || className === 'gradient') {
        sectionClassesToRemove.push(className);
      }
    });
    sectionClassesToRemove.forEach(className => section.classList.remove(className));
  }

  // Remove on load
  removeColorSchemeClasses();

  // Watch for changes (in case Shopify adds classes dynamically)
  const observer = new MutationObserver(removeColorSchemeClasses);
  observer.observe(section, { attributes: true, attributeFilter: ['class'] });
  if (section.parentElement) {
    observer.observe(section.parentElement, { attributes: true, attributeFilter: ['class'] });
  }

  const slides = section.querySelectorAll('.slideshow-hero__slide');
  const tabs = section.querySelectorAll('.slideshow-hero__tab');
  const progressFill = section.querySelector('.slideshow-hero__progress-fill');

  if (slides.length <= 1) return;

  let currentSlide = 0;
  let progressInterval;
  let slideTimeout;
  const slideDuration = 5000; // 5 seconds
  const progressUpdateInterval = 50; // Update every 50ms for smooth animation

  function updateProgress() {
    let progress = 0;
    const increment = (100 / slideDuration) * progressUpdateInterval;

    progressInterval = setInterval(() => {
      progress += increment;
      if (progressFill) {
        progressFill.style.width = Math.min(progress, 100) + '%';
      }

      if (progress >= 100) {
        clearInterval(progressInterval);
      }
    }, progressUpdateInterval);
  }

  function goToSlide(index) {
    // Clear existing intervals and timeouts
    clearInterval(progressInterval);
    clearTimeout(slideTimeout);

    // Remove active classes
    slides.forEach(slide => slide.classList.remove('active'));
    tabs.forEach(tab => tab.classList.remove('active'));

    // Add active class to new slide
    currentSlide = index;
    slides[currentSlide].classList.add('active');
    tabs[currentSlide].classList.add('active');

    // Reset and start progress bar
    if (progressFill) {
      progressFill.style.width = '0%';
    }
    updateProgress();

    // Set timeout for next slide
    slideTimeout = setTimeout(() => {
      const nextSlide = (currentSlide + 1) % slides.length;
      goToSlide(nextSlide);
    }, slideDuration);
  }

  // Tab click handlers
  tabs.forEach((tab, index) => {
    tab.addEventListener('click', () => {
      goToSlide(index);
    });
  });

  // Start the slideshow
  goToSlide(0);

  // Cleanup on theme editor section unload
  document.addEventListener('shopify:section:unload', (event) => {
    if (event.detail.sectionId === '{{ section.id }}') {
      clearInterval(progressInterval);
      clearTimeout(slideTimeout);
      if (observer) {
        observer.disconnect();
      }
    }
  });
})();
</script>

{% schema %}
{
  "name": "Hero Blooming Garden",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Tools for a blooming garden experience"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "From sturdy shovels and gloves to fertilizers and pruning shears, our gardening products will help you cultivate a thriving and beautiful garden."
    },
    {
      "type": "header",
      "content": "Button 1"
    },
    {
      "type": "text",
      "id": "button_1_text",
      "label": "Button 1 Text",
      "default": "Shop all"
    },
    {
      "type": "url",
      "id": "button_1_link",
      "label": "Button 1 Link"
    },
    {
      "type": "header",
      "content": "Button 2"
    },
    {
      "type": "text",
      "id": "button_2_text",
      "label": "Button 2 Text",
      "default": "Pruning"
    },
    {
      "type": "url",
      "id": "button_2_link",
      "label": "Button 2 Link"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "limit": 4,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Background Image"
        },
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label",
          "default": "Pruning",
          "info": "This label will appear in the navigation tabs at the bottom"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Blooming Garden",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "tab_label": "Pruning"
          }
        },
        {
          "type": "slide",
          "settings": {
            "tab_label": "Plants"
          }
        },
        {
          "type": "slide",
          "settings": {
            "tab_label": "Outdoor"
          }
        },
        {
          "type": "slide",
          "settings": {
            "tab_label": "Garden"
          }
        }
      ]
    }
  ]
}
{% endschema %}
