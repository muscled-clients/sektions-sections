{% style %}
  #shopify-section-{{ section.id }} {
    --vfs6-bg: {{ section.settings.background_color }};
    --vfs6-heading-color: {{ section.settings.heading_color }};
    --vfs6-border-color: {{ section.settings.video_border_color }};
    --vfs6-icon-color: {{ section.settings.icon_color }};
    --vfs6-icon-ring: {{ section.settings.icon_ring_color }};
    --vfs6-card-radius: {{ section.settings.video_border_radius }}px;
    margin-top: {{ section.settings.margin_top }}px;
    margin-bottom: {{ section.settings.margin_bottom }}px;
  }
{% endstyle %}

<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Josefin+Sans:wght@600;700&display=swap');

  .video-from-social-6 {
    background: var(--vfs6-bg, #e0d4f7);
    padding: 40px 20px;
    font-family: 'Montserrat', sans-serif;
    overflow: hidden;
  }

  .video-from-social-6__container {
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Swiper Container */
  .video-from-social-6__carousel {
    position: relative;
  }

  .video-from-social-6__swiper {
    overflow: visible;
    padding-bottom: 25px;
  }

  .video-from-social-6__swiper .swiper-wrapper {
    align-items: flex-start;
  }

  .video-from-social-6__slide {
    width: 140px !important;
    flex-shrink: 0;
  }

  /* Staggered effect */
  .video-from-social-6--staggered .video-from-social-6__slide:nth-child(even) {
    transform: translateY(20px);
  }

  /* Video Card */
  .video-from-social-6__card {
    position: relative;
    width: 100%;
    border-radius: var(--vfs6-card-radius, 20px);
    overflow: visible;
    background: #000;
    border: 3px solid var(--vfs6-border-color, #3b4fd9);
  }

  .video-from-social-6__video-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 140%;
    background: #1a1a1a;
    border-radius: calc(var(--vfs6-card-radius, 20px) - 3px);
    overflow: hidden;
  }

  .video-from-social-6__video,
  .video-from-social-6__iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none;
  }

  .video-from-social-6__placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .video-from-social-6__placeholder svg {
    width: 48px;
    height: 48px;
    color: #fff;
    opacity: 0.7;
  }

  /* Social Icon Badge */
  .video-from-social-6__social-icon {
    position: absolute;
    bottom: -16px;
    right: 10px;
    width: 40px;
    height: 40px;
    background: var(--vfs6-icon-color, #3b4fd9);
    border: 3px solid var(--vfs6-icon-ring, #b8ff57);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .video-from-social-6__social-icon svg {
    width: 18px;
    height: 18px;
    color: #fff;
    fill: #fff;
  }

  /* Footer with heading */
  .video-from-social-6__footer {
    text-align: center;
    padding: 40px 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .video-from-social-6__heading {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--vfs6-heading-color, #3b4fd9);
    margin: 0;
    line-height: 1.2;
  }

  .video-from-social-6__footer-icons {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .video-from-social-6__footer-icon {
    width: 28px;
    height: 28px;
    color: var(--vfs6-heading-color, #3b4fd9);
  }

  /* Navigation Arrows */
  .video-from-social-6__nav {
    display: none;
  }

  .video-from-social-6__nav-btn {
    position: absolute;
    top: 40%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.25s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .video-from-social-6__nav-btn:hover {
    background: #f5f5f5;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .video-from-social-6__nav-btn svg {
    width: 18px;
    height: 18px;
    color: #333;
  }

  .video-from-social-6__nav-btn--prev {
    left: -20px;
  }

  .video-from-social-6__nav-btn--next {
    right: -20px;
  }

  .video-from-social-6__nav-btn.swiper-button-disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  /* Tablet styles */
  @media (min-width: 768px) {
    .video-from-social-6 {
      padding: 40px 30px;
    }

    .video-from-social-6__slide {
      width: 180px !important;
    }

    .video-from-social-6__heading {
      font-size: 32px;
    }

    .video-from-social-6__social-icon {
      width: 42px;
      height: 42px;
      bottom: -16px;
      right: 10px;
    }

    .video-from-social-6__social-icon svg {
      width: 18px;
      height: 18px;
    }

    .video-from-social-6__footer {
      padding-top: 30px;
    }

    .video-from-social-6--staggered .video-from-social-6__slide:nth-child(even) {
      transform: translateY(25px);
    }
  }

  /* Desktop styles */
  @media (min-width: 1024px) {
    .video-from-social-6 {
      padding: 50px 50px;
    }

    .video-from-social-6__slide {
      width: 220px !important;
    }

    .video-from-social-6__heading {
      font-size: 36px;
    }

    .video-from-social-6--staggered .video-from-social-6__slide:nth-child(even) {
      transform: translateY(30px);
    }

    .video-from-social-6__footer-icon {
      width: 28px;
      height: 28px;
    }

    .video-from-social-6__social-icon {
      width: 46px;
      height: 46px;
      bottom: -18px;
      right: 12px;
    }

    .video-from-social-6__social-icon svg {
      width: 20px;
      height: 20px;
    }

    .video-from-social-6__nav {
      display: block;
    }
  }

  /* Large desktop */
  @media (min-width: 1400px) {
    .video-from-social-6__slide {
      width: 260px !important;
    }

    .video-from-social-6__social-icon {
      width: 50px;
      height: 50px;
      bottom: -20px;
      right: 14px;
    }

    .video-from-social-6__social-icon svg {
      width: 22px;
      height: 22px;
    }
  }

  /* Stagger padding adjustment */
  .video-from-social-6--staggered {
    padding-bottom: 25px;
  }

  @media (min-width: 1024px) {
    .video-from-social-6--staggered {
      padding-bottom: 35px;
    }
  }
</style>

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

<section
  class="video-from-social-6 {% if section.settings.staggered_layout %}video-from-social-6--staggered{% endif %}"
  data-section-id="{{ section.id }}"
>
  <div class="video-from-social-6__container">
    <div class="video-from-social-6__carousel">
      <div class="video-from-social-6__swiper swiper">
        <div class="swiper-wrapper">
        {%- for block in section.blocks -%}
          <div class="video-from-social-6__slide swiper-slide" {{ block.shopify_attributes }}>
            <div class="video-from-social-6__card">
              <div class="video-from-social-6__video-wrapper">
                {%- if block.settings.video != blank -%}
                  <video
                    class="video-from-social-6__video"
                    muted
                    loop
                    playsinline
                    preload="metadata"
                    data-autoplay="{{ section.settings.autoplay }}"
                  >
                    {%- for source in block.settings.video.sources -%}
                      <source src="{{ source.url }}" type="{{ source.mime_type }}">
                    {%- endfor -%}
                  </video>
                {%- elsif block.settings.video_url != blank -%}
                  <iframe
                    class="video-from-social-6__iframe"
                    src="{{ block.settings.video_url }}"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    loading="lazy"
                  ></iframe>
                {%- else -%}
                  <div class="video-from-social-6__placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                  </div>
                {%- endif -%}
              </div>

              <!-- Social Platform Icon Badge -->
              <div class="video-from-social-6__social-icon">
                {%- case block.settings.social_platform -%}
                  {%- when 'youtube' -%}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                  {%- when 'instagram' -%}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                  {%- when 'tiktok' -%}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                  {%- when 'pinterest' -%}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738a.36.36 0 0 1 .083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.632-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/></svg>
                  {%- when 'facebook' -%}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                {%- endcase -%}
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>

      <!-- Navigation -->
      <div class="video-from-social-6__nav">
        <button class="video-from-social-6__nav-btn video-from-social-6__nav-btn--prev" aria-label="Previous">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <button class="video-from-social-6__nav-btn video-from-social-6__nav-btn--next" aria-label="Next">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>
    </div>

    <!-- Footer with heading and social icons -->
    {%- if section.settings.heading != blank -%}
      <div class="video-from-social-6__footer">
        <h2 class="video-from-social-6__heading">{{ section.settings.heading }}</h2>
        <div class="video-from-social-6__footer-icons">
          {%- if section.settings.show_tiktok_icon -%}
            <svg class="video-from-social-6__footer-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
          {%- endif -%}
          {%- if section.settings.show_instagram_icon -%}
            <svg class="video-from-social-6__footer-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</section>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const section = document.querySelector('.video-from-social-6[data-section-id="{{ section.id }}"]');
  if (!section) return;

  // Initialize Swiper
  const swiperEl = section.querySelector('.video-from-social-6__swiper');
  const prevBtn = section.querySelector('.video-from-social-6__nav-btn--prev');
  const nextBtn = section.querySelector('.video-from-social-6__nav-btn--next');

  const swiper = new Swiper(swiperEl, {
    slidesPerView: 'auto',
    spaceBetween: 12,
    loop: false,
    grabCursor: true,
    navigation: {
      prevEl: prevBtn,
      nextEl: nextBtn
    },
    breakpoints: {
      768: {
        spaceBetween: 16
      },
      1024: {
        spaceBetween: 20
      }
    }
  });

  // Video autoplay on visibility
  const videos = section.querySelectorAll('.video-from-social-6__video');
  const autoplay = '{{ section.settings.autoplay }}' === 'true';

  if (autoplay && videos.length > 0) {
    // Play first visible video
    const playVisibleVideos = () => {
      videos.forEach(video => {
        const rect = video.getBoundingClientRect();
        const isVisible = rect.left < window.innerWidth && rect.right > 0;
        if (isVisible) {
          video.play().catch(() => {});
        } else {
          video.pause();
        }
      });
    };

    playVisibleVideos();
    swiper.on('slideChange', playVisibleVideos);
    swiper.on('transitionEnd', playVisibleVideos);
  }

  // Mute/unmute functionality
  let currentUnmutedVideo = null;

  section.querySelectorAll('.video-from-social-6__mute-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const card = this.closest('.video-from-social-6__card');
      const video = card.querySelector('.video-from-social-6__video');
      if (!video) return;

      if (video.muted) {
        // Mute any currently unmuted video
        if (currentUnmutedVideo && currentUnmutedVideo !== video) {
          currentUnmutedVideo.muted = true;
          const otherBtn = currentUnmutedVideo.closest('.video-from-social-6__card').querySelector('.video-from-social-6__mute-btn');
          if (otherBtn) otherBtn.classList.remove('is-unmuted');
        }

        video.muted = false;
        this.classList.add('is-unmuted');
        currentUnmutedVideo = video;
        video.play().catch(() => {});
      } else {
        video.muted = true;
        this.classList.remove('is-unmuted');
        currentUnmutedVideo = null;
      }
    });
  });

  // Parse YouTube/TikTok URLs for iframes
  section.querySelectorAll('.video-from-social-6__iframe').forEach(iframe => {
    let src = iframe.getAttribute('src') || '';

    // YouTube
    const ytMatch = src.match(/youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/);
    if (ytMatch) {
      iframe.src = 'https://www.youtube.com/embed/' + ytMatch[1] + '?autoplay=0&mute=1';
    }

    const ytShortMatch = src.match(/youtu\.be\/([a-zA-Z0-9_-]+)/);
    if (ytShortMatch) {
      iframe.src = 'https://www.youtube.com/embed/' + ytShortMatch[1] + '?autoplay=0&mute=1';
    }

    // TikTok - just set as-is since TikTok embeds are complex
  });
});
</script>

{% schema %}
{
  "name": "SEK Video from Social 6",
  "tag": "section",
  "class": "section-video-from-social-6",
  "settings": [
    {
      "type": "header",
      "content": "Footer heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Follow us on socials"
    },
    {
      "type": "checkbox",
      "id": "show_tiktok_icon",
      "label": "Show TikTok icon in footer",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_instagram_icon",
      "label": "Show Instagram icon in footer",
      "default": true
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "staggered_layout",
      "label": "Staggered card layout",
      "default": false,
      "info": "Offset every other card vertically"
    },
    {
      "type": "range",
      "id": "video_border_radius",
      "label": "Card border radius",
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Video settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay visible videos",
      "default": true,
      "info": "Videos will play muted when visible"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#e0d4f7"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#3b4fd9"
    },
    {
      "type": "color",
      "id": "video_border_color",
      "label": "Card border color",
      "default": "#3b4fd9"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Social icon background",
      "default": "#3b4fd9"
    },
    {
      "type": "color",
      "id": "icon_ring_color",
      "label": "Social icon ring color",
      "default": "#b8ff57"
    },
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "video",
          "id": "video",
          "label": "Video",
          "info": "Upload a vertical video (9:16 ratio recommended)"
        },
        {
          "type": "text",
          "id": "video_url",
          "label": "Or video embed URL",
          "info": "YouTube, TikTok, or other embed URL"
        },
        {
          "type": "select",
          "id": "social_platform",
          "label": "Social platform icon",
          "options": [
            { "value": "youtube", "label": "YouTube" },
            { "value": "instagram", "label": "Instagram" },
            { "value": "tiktok", "label": "TikTok" },
            { "value": "pinterest", "label": "Pinterest" },
            { "value": "facebook", "label": "Facebook" }
          ],
          "default": "youtube"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "SEK Video from Social 6",
      "blocks": [
        { "type": "video", "settings": { "social_platform": "youtube" } },
        { "type": "video", "settings": { "social_platform": "instagram" } },
        { "type": "video", "settings": { "social_platform": "pinterest" } },
        { "type": "video", "settings": { "social_platform": "tiktok" } }
      ]
    }
  ]
}
{% endschema %}
