{% comment %}
  Natural & Tasty Features Section
  Expandable feature cards with accordion functionality
{% endcomment %}

<div class="natural-tasty-section"
     data-section-id="{{ section.id }}"
     data-allow-multiple="{{ section.settings.allow_multiple_open }}"
     data-default-expanded="{{ section.settings.default_expanded_card }}"
     style="
  --icon-border-weight: {{ section.settings.icon_border_weight }}px;
  --plus-icon-size: {{ section.settings.plus_icon_size }}px;
  --card-padding: {{ section.settings.card_padding }}px;
  --plus-icon-weight: {{ section.settings.plus_icon_weight }};
  --card-border-radius: {{ section.settings.card_border_radius }}px;
  --desktop-columns: {{ section.settings.desktop_columns }};
  --tablet-columns: {{ section.settings.tablet_columns }};
  --mobile-columns: {{ section.settings.mobile_columns }};
  --card-gap: {{ section.settings.card_gap }}px;
  --heading-size: {{ section.settings.heading_size }}px;
  --heading-weight: {{ section.settings.heading_weight }};
  --subheading-size: {{ section.settings.subheading_size }}px;
  --subheading-weight: {{ section.settings.subheading_weight }};
  --card-title-size: {{ section.settings.card_title_size }}px;
  --card-title-weight: {{ section.settings.card_title_weight }};
  --card-description-size: {{ section.settings.card_description_size }}px;
  --section-padding-top: {{ section.settings.section_padding_top }}px;
  --section-padding-bottom: {{ section.settings.section_padding_bottom }}px;
  --animation-speed: {{ section.settings.animation_speed }}s;
  --max-content-height: {{ section.settings.max_content_height }}px;
">
  <div class="natural-tasty__container">
    <!-- Cookie Illustration -->
    {% if section.settings.cookie_image != blank %}
      <div class="natural-tasty__cookie">
        <img src="{{ section.settings.cookie_image | img_url: '150x' }}" alt="Cookie" loading="lazy">
      </div>
    {% else %}
      <div class="natural-tasty__cookie">
        <svg width="120" height="80" viewBox="0 0 120 80" fill="none">
          <ellipse cx="60" cy="40" rx="50" ry="30" fill="#D4A574"/>
          <circle cx="45" cy="35" r="4" fill="#8B6F47"/>
          <circle cx="65" cy="42" r="3" fill="#8B6F47"/>
          <circle cx="52" cy="48" r="3.5" fill="#8B6F47"/>
          <circle cx="70" cy="32" r="3" fill="#8B6F47"/>
          <path d="M55 25 Q60 20 65 25" stroke="#A8D5BA" stroke-width="2" fill="none"/>
        </svg>
      </div>
    {% endif %}

    <!-- Heading -->
    {% if section.settings.heading != blank %}
      <h2 class="natural-tasty__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    <!-- Subheading -->
    {% if section.settings.subheading != blank %}
      <p class="natural-tasty__subheading">{{ section.settings.subheading }}</p>
    {% endif %}

    <!-- Feature Cards -->
    <div class="natural-tasty__cards">
      {% for block in section.blocks %}
        <div class="feature-card" data-card-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
          <div class="feature-card__header">
            <div class="feature-card__icon-wrapper">
              <div class="feature-card__icon" style="background-color: {{ block.settings.icon_bg }};">
                {% if block.settings.icon_image != blank %}
                  <img src="{{ block.settings.icon_image | img_url: '48x' }}" alt="{{ block.settings.title }}" class="feature-card__icon-img">
                {% else %}
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                  </svg>
                {% endif %}
              </div>
              <h3 class="feature-card__title">{{ block.settings.title }}</h3>
            </div>
            <button class="feature-card__toggle" aria-label="Toggle {{ block.settings.title }}">
              <span class="toggle-plus">+</span>
              <span class="toggle-close">×</span>
            </button>
          </div>
          <div class="feature-card__content">
            <p class="feature-card__description">{{ block.settings.description }}</p>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- CTA Button -->
    {% if section.settings.button_text != blank %}
      <div class="natural-tasty__cta">
        <a href="{{ section.settings.button_url }}" class="natural-tasty__button">
          {{ section.settings.button_text }}
        </a>
      </div>
    {% endif %}
  </div>
</div>

<style>
.natural-tasty-section {
  width: 100%;
  background-color: {{ section.settings.section_bg | default: '#f4f0ea' }};
  padding: var(--section-padding-top, 80px) 20px var(--section-padding-bottom, 80px);
  overflow: hidden;
}

.natural-tasty__container {
  max-width: 1400px;
  margin: 0 auto;
}

.natural-tasty__cookie {
  display: flex;
  justify-content: center;
  margin-bottom: 30px;
}

.natural-tasty__cookie img {
  display: block;
  max-width: 120px;
  height: auto;
}

.natural-tasty__heading {
  font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: var(--heading-size, 48px);
  font-weight: var(--heading-weight, 700);
  color: #000000;
  text-align: center;
  margin: 0 0 20px;
  line-height: 1.2;
}

.natural-tasty__subheading {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: var(--subheading-size, 18px);
  font-weight: var(--subheading-weight, 400);
  color: #333333;
  text-align: center;
  margin: 0 auto 60px;
  max-width: 800px;
  line-height: 1.6;
}

.natural-tasty__cards {
  display: grid;
  grid-template-columns: repeat(var(--desktop-columns, 4), 1fr);
  gap: var(--card-gap, 20px);
  margin-bottom: 50px;
  align-items: start;
}

.feature-card {
  background-color: #ffffff;
  border-radius: var(--card-border-radius, 16px);
  padding: var(--card-padding, 24px);
  transition: all var(--animation-speed, 0.4s) ease;
  height: auto;
}

{% if section.settings.icon_hover_transparent %}
.feature-card:hover .feature-card__icon {
  background-color: transparent !important;
}
{% endif %}

.feature-card__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.feature-card__icon-wrapper {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.feature-card__icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: background-color 0.3s ease;
  border: var(--icon-border-weight, 2px) solid #000000;
}

.feature-card__icon svg {
  width: 24px;
  height: 24px;
  stroke: #000000;
  stroke-width: 2;
}

.feature-card__icon-img {
  width: 24px;
  height: 24px;
  object-fit: contain;
  display: block;
}

.feature-card__title {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: var(--card-title-size, 18px);
  font-weight: var(--card-title-weight, 700);
  color: #000000;
  margin: 0;
  line-height: 1.3;
}

.feature-card__toggle {
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  font-size: var(--plus-icon-size, 32px);
  font-weight: var(--plus-icon-weight, 300);
  line-height: 1;
  color: #000000;
  transition: transform 0.3s ease;
  flex-shrink: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.feature-card__toggle:hover {
  transform: scale(1.1);
}

.toggle-close {
  display: none;
}

.feature-card.expanded .toggle-plus {
  display: none;
}

.feature-card.expanded .toggle-close {
  display: block;
}

.feature-card__content {
  max-height: 0;
  overflow: hidden;
  transition: max-height var(--animation-speed, 0.4s) ease, opacity var(--animation-speed, 0.4s) ease, margin-top var(--animation-speed, 0.4s) ease;
  opacity: 0;
}

.feature-card.expanded .feature-card__content {
  max-height: var(--max-content-height, 500px);
  opacity: 1;
  margin-top: 16px;
}

.feature-card__description {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: var(--card-description-size, 15px);
  font-weight: 400;
  color: #666666;
  line-height: 1.6;
  margin: 0;
}

.natural-tasty__cta {
  display: flex;
  justify-content: center;
}

.natural-tasty__button {
  display: inline-block;
  background-color: {{ section.settings.button_bg | default: '#F4E04D' }};
  color: {{ section.settings.button_text_color | default: '#000000' }};
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 16px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 16px 50px;
  border-radius: 50px;
  border: 2px solid #000000;
  text-decoration: none;
  transition: all 0.3s ease;
  cursor: pointer;
}

.natural-tasty__button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

@media screen and (max-width: 1024px) {
  .natural-tasty__cards {
    grid-template-columns: repeat(var(--tablet-columns, 2), 1fr);
  }
}

@media screen and (max-width: 768px) {
  .natural-tasty__cards {
    grid-template-columns: repeat(var(--mobile-columns, 1), 1fr);
  }
}

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var sectionId = '{{ section.id }}';
  var section = document.querySelector('[data-section-id="' + sectionId + '"]');

  if (!section) return;

  var cards = section.querySelectorAll('.feature-card');
  var allowMultiple = section.getAttribute('data-allow-multiple') === 'true';
  var defaultExpandedIndex = parseInt(section.getAttribute('data-default-expanded'), 10);

  function closeAllCards() {
    cards.forEach(function(card) {
      card.classList.remove('expanded');
    });
  }

  // Expand default card if specified
  if (defaultExpandedIndex >= 0 && defaultExpandedIndex < cards.length) {
    cards[defaultExpandedIndex].classList.add('expanded');
  }

  cards.forEach(function(card, index) {
    var toggle = card.querySelector('.feature-card__toggle');

    if (toggle) {
      toggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        var isCurrentlyExpanded = card.classList.contains('expanded');

        if (allowMultiple) {
          // In multiple mode, just toggle the current card
          if (isCurrentlyExpanded) {
            card.classList.remove('expanded');
          } else {
            card.classList.add('expanded');
          }
        } else {
          // In single mode, close all cards first
          closeAllCards();

          // If this card wasn't expanded, expand it
          if (!isCurrentlyExpanded) {
            card.classList.add('expanded');
          }
        }
      });
    }
  });
});
</script>

{% schema %}
{
  "name": "Natural & Tasty Features",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "color",
      "id": "section_bg",
      "label": "Background Color",
      "default": "#f4f0ea"
    },
    {
      "type": "image_picker",
      "id": "cookie_image",
      "label": "Cookie Image"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "All Natural & Unbelievably Tasty"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "For those who prioritize their wellness, we handled the tough stuff so you can savor life!"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "SHOP NOW"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "color",
      "id": "button_bg",
      "label": "Button Background Color",
      "default": "#F4E04D"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "range",
      "id": "desktop_columns",
      "label": "Desktop Columns",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4,
      "info": "Number of columns on desktop screens"
    },
    {
      "type": "range",
      "id": "tablet_columns",
      "label": "Tablet Columns",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2,
      "info": "Number of columns on tablet screens"
    },
    {
      "type": "select",
      "id": "mobile_columns",
      "label": "Mobile Columns",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ],
      "default": "1",
      "info": "Number of columns on mobile screens"
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "Card Gap",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 20,
      "info": "Space between cards"
    },
    {
      "type": "header",
      "content": "Typography Settings"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Size",
      "min": 28,
      "max": 72,
      "step": 2,
      "unit": "px",
      "default": 48,
      "info": "Font size for main heading"
    },
    {
      "type": "range",
      "id": "heading_weight",
      "label": "Heading Weight",
      "min": 400,
      "max": 900,
      "step": 100,
      "default": 700,
      "info": "Font weight for main heading (400=normal, 700=bold)"
    },
    {
      "type": "range",
      "id": "subheading_size",
      "label": "Subheading Size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 18,
      "info": "Font size for subheading"
    },
    {
      "type": "range",
      "id": "subheading_weight",
      "label": "Subheading Weight",
      "min": 300,
      "max": 600,
      "step": 100,
      "default": 400,
      "info": "Font weight for subheading"
    },
    {
      "type": "range",
      "id": "card_title_size",
      "label": "Card Title Size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 18,
      "info": "Font size for card titles"
    },
    {
      "type": "range",
      "id": "card_title_weight",
      "label": "Card Title Weight",
      "min": 400,
      "max": 900,
      "step": 100,
      "default": 700,
      "info": "Font weight for card titles"
    },
    {
      "type": "range",
      "id": "card_description_size",
      "label": "Card Description Size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 15,
      "info": "Font size for card descriptions"
    },
    {
      "type": "header",
      "content": "Spacing Settings"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Section Padding Top",
      "min": 20,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 80,
      "info": "Top padding for the section"
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Section Padding Bottom",
      "min": 20,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 80,
      "info": "Bottom padding for the section"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "animation_speed",
      "label": "Animation Speed",
      "min": 0.2,
      "max": 1.0,
      "step": 0.1,
      "unit": "s",
      "default": 0.4,
      "info": "Speed of accordion animation"
    },
    {
      "type": "range",
      "id": "max_content_height",
      "label": "Max Content Height",
      "min": 300,
      "max": 1000,
      "step": 50,
      "unit": "px",
      "default": 500,
      "info": "Maximum height for expanded card content"
    },
    {
      "type": "header",
      "content": "Behavior Settings"
    },
    {
      "type": "checkbox",
      "id": "allow_multiple_open",
      "label": "Allow Multiple Cards Open",
      "default": false,
      "info": "Allow multiple cards to be expanded at the same time"
    },
    {
      "type": "range",
      "id": "default_expanded_card",
      "label": "Default Expanded Card",
      "min": -1,
      "max": 10,
      "step": 1,
      "default": -1,
      "info": "Which card is expanded by default (0 = first card, -1 = none)"
    },
    {
      "type": "checkbox",
      "id": "icon_hover_transparent",
      "label": "Icon Hover Transparent",
      "default": true,
      "info": "Make icon background transparent on hover"
    },
    {
      "type": "header",
      "content": "Card Settings"
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card Padding",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24,
      "info": "Controls the inner padding of each card"
    },
    {
      "type": "range",
      "id": "icon_border_weight",
      "label": "Icon Border Weight",
      "min": 1,
      "max": 5,
      "step": 1,
      "unit": "px",
      "default": 2,
      "info": "Controls the thickness of the border around icons"
    },
    {
      "type": "range",
      "id": "plus_icon_size",
      "label": "Plus Icon Size",
      "min": 20,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 32,
      "info": "Controls the size of the +/× toggle icon"
    },
    {
      "type": "range",
      "id": "plus_icon_weight",
      "label": "Plus Icon Weight",
      "min": 100,
      "max": 900,
      "step": 100,
      "default": 300,
      "info": "Controls the thickness/weight of the +/× icon (100=thin, 900=bold)"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card Border Radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 16,
      "info": "Controls the roundness of card corners"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature Card",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Feature"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Add your feature description here."
        },
        {
          "type": "color",
          "id": "icon_bg",
          "label": "Icon Background Color",
          "default": "#E0E0E0"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icon Image",
          "info": "Upload a custom icon image (recommended size: 48x48px)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Natural & Tasty Features",
      "blocks": [
        {
          "type": "feature",
          "settings": {
            "title": "Gluten-free",
            "description": "Made with high-quality ingredients and are completely gluten-free. We've carefully crafted our recipe to ensure that everyone, including those with gluten sensitivities or celiac disease, can enjoy a tasty treat.",
            "icon_bg": "#E0E0E0"
          }
        },
        {
          "type": "feature",
          "settings": {
            "title": "Milk-free",
            "description": "Our milk-free recipe ensures that even those with dietary restrictions can partake in the fun.",
            "icon_bg": "#F4E04D"
          }
        },
        {
          "type": "feature",
          "settings": {
            "title": "Nut-free",
            "description": "Our nut-free options are made in facilities free from cross-contamination so everyone can indulge safely.",
            "icon_bg": "#F4C2C2"
          }
        },
        {
          "type": "feature",
          "settings": {
            "title": "Egg-free",
            "description": "We've perfected our egg-free recipes for the same great taste without compromise.",
            "icon_bg": "#C8E6C9"
          }
        }
      ]
    }
  ]
}
{% endschema %}
